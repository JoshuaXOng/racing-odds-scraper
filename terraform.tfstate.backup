{
  "version": 4,
  "terraform_version": "1.0.9",
  "serial": 25,
  "lineage": "69cef145-d635-8c04-7d58-e8c9a04777af",
  "outputs": {},
  "resources": [
    {
      "mode": "managed",
      "type": "digitalocean_droplet",
      "name": "racing-odds-scraper",
      "provider": "provider[\"registry.terraform.io/digitalocean/digitalocean\"]",
      "instances": [
        {
          "schema_version": 1,
          "attributes": {
            "backups": false,
            "created_at": "2022-04-16T13:06:18Z",
            "disk": 25,
            "droplet_agent": null,
            "graceful_shutdown": false,
            "id": "295612895",
            "image": "docker-18-04",
            "ipv4_address": "165.22.51.59",
            "ipv4_address_private": "10.104.0.2",
            "ipv6": false,
            "ipv6_address": "",
            "locked": false,
            "memory": 1024,
            "monitoring": false,
            "name": "racing-odds-scraper",
            "price_hourly": 0.00744,
            "price_monthly": 5,
            "private_networking": true,
            "region": "sgp1",
            "resize_disk": true,
            "size": "s-1vcpu-1gb",
            "ssh_keys": [
              "87:be:6c:dd:e5:ab:7e:2f:9d:42:e2:5b:3a:d5:11:15"
            ],
            "status": "active",
            "tags": null,
            "urn": "do:droplet:295612895",
            "user_data": "1f5f0a38202182d90795c3800710a2b3d7a5b101",
            "vcpus": 1,
            "volume_ids": [],
            "vpc_uuid": "7c4f377f-1627-4176-b0b4-d112d2fa2b2a"
          },
          "sensitive_attributes": [],
          "private": "eyJzY2hlbWFfdmVyc2lvbiI6IjEifQ==",
          "dependencies": [
            "digitalocean_ssh_key.racing-odds-scraper-key",
            "module.container-server.data.cloudinit_config.config"
          ]
        }
      ]
    },
    {
      "mode": "managed",
      "type": "digitalocean_ssh_key",
      "name": "racing-odds-scraper-key",
      "provider": "provider[\"registry.terraform.io/digitalocean/digitalocean\"]",
      "instances": [
        {
          "schema_version": 0,
          "attributes": {
            "fingerprint": "87:be:6c:dd:e5:ab:7e:2f:9d:42:e2:5b:3a:d5:11:15",
            "id": "34253358",
            "name": "racing-odds-scraper-key",
            "public_key": "ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABgQDOZyAy82xk9HbeNECrWltgq49Ig9fpWDlsSx4aU+hz18uJgrHj9G6KQiKqq4f0zki3CHz/fMs3P/M+JW1XDXIiKDvuFGZE9i3rV00R0MrZW2nfBNuiLLWp6VsZqNrlLyytyEzILFmjOvEuS4o8VHofHllBuBFNacWn6fUJa9BiG/bie0+QImQ/bxIMXPp4EPiDlZG/NXrI/PkGMdcFNWqnZBBHGTQszL4tlXuQHsdyK0LpywPLb+Dp4DVZYCya5BSKDy3Fx42pSvdRPbmISikfrEuJkNa0OoWJjCMSL1Mb5kG8ylhqyomsmdUiTkdxUz/rhD+sYrZgbZq3x5WRoLkamu1qvWwwHUebLHj6an7KkicaA9sIqcOnf8rRWtRhJSv/1gToxfxzQ4EgWmmcO0AWaddADtquIy9QRWp1IalUPR/KjExkH4t5YUJZ4LrqZecCr54ZC6x8qjSzx4VyrgzUJ11r4l9fKJ8iSAkwPXBePaBTr7YNd3cjQg9KnwQ7koE= joshua ong@DESKTOP-2L25P9V\r\n"
          },
          "sensitive_attributes": [],
          "private": "bnVsbA=="
        }
      ]
    },
    {
      "module": "module.container-server",
      "mode": "data",
      "type": "cloudinit_config",
      "name": "config",
      "provider": "provider[\"registry.terraform.io/hashicorp/cloudinit\"]",
      "instances": [
        {
          "schema_version": 0,
          "attributes": {
            "base64_encode": false,
            "boundary": "MIMEBOUNDARY",
            "gzip": false,
            "id": "1849537526",
            "part": [
              {
                "content": "#cloud-config\r\n\r\nwrite_files:\r\n  - path: /var/app/.env\r\n    permissions: 0644\r\n    content: Q09NUE9TRV9ET0NLRVJfSU1BR0U9ZG9ja2VyL2NvbXBvc2UKQ09NUE9TRV9ET0NLRVJfVEFHPWxhdGVzdApET0NLRVJfTkVUV09SSz13ZWIKRE9NQUlOPXJhbW11cy50ZWNoCklNQUdFX05BTUU9am9zaHVheG9uZy9yYWNpbmctb2Rkcy1zY3JhcGVyCklNQUdFX1RBRz1sYXRlc3QKTEVUU0VOQ1JZUFRfRU1BSUw9am9zaHVhb25nMjAwMEBnbWFpbC5jb20=\r\n    encoding: b64\r\n  - path: /var/app/docker-compose.traefik.yaml\r\n    permissions: 0644\r\n    content: dmVyc2lvbjogIjMuMyINCg0Kc2VydmljZXM6DQogIHRyYWVmaWs6DQogICAgcmVzdGFydDogdW5sZXNzLXN0b3BwZWQNCiAgICBpbWFnZTogInRyYWVmaWs6JHtUUkFFRklLX0lNQUdFX1RBRzotdjIuMn0iDQogICAgY29udGFpbmVyX25hbWU6ICJ0cmFlZmlrIg0KICAgIGNvbW1hbmQ6DQogICAgICAtICItLWxvZy5sZXZlbD0ke1RSQUVGSUtfTE9HX0xFVkVMOi1pbmZvfSINCiAgICAgIC0gIi0tYXBpLmRhc2hib2FyZD0ke1RSQUVGSUtfQVBJX0RBU0hCT0FSRDotZmFsc2V9Ig0KICAgICAgLSAiLS1hY2Nlc3Nsb2cuZmlsdGVycy5zdGF0dXNjb2Rlcz00MDAtNTk5Ig0KICAgICAgLSAiLS1hY2Nlc3Nsb2cuZmlsdGVycy5yZXRyeWF0dGVtcHRzPXRydWUiDQogICAgICAtICItLWFjY2Vzc2xvZy5maWx0ZXJzLm1pbmR1cmF0aW9uPTEwMG1zIg0KICAgICAgLSAiLS1wcm92aWRlcnMuZG9ja2VyPXRydWUiDQogICAgICAtICItLXByb3ZpZGVycy5kb2NrZXIuZXhwb3NlZGJ5ZGVmYXVsdD0ke1RSQUVGSUtfRVhQT1NFRF9CWV9ERUZBVUxUOi10cnVlfSINCiAgICAgIC0gIi0tcHJvdmlkZXJzLmRvY2tlci5uZXR3b3JrPSR7RE9DS0VSX05FVFdPUks6LXdlYn0iDQogICAgICAtICItLWVudHJ5cG9pbnRzLndlYi5hZGRyZXNzPTo4MCINCiAgICAgIC0gIi0tZW50cnlwb2ludHMud2ViLmh0dHAucmVkaXJlY3Rpb25zLmVudHJ5UG9pbnQudG89d2Vic2VjdXJlIg0KICAgICAgLSAiLS1lbnRyeXBvaW50cy53ZWIuaHR0cC5yZWRpcmVjdGlvbnMuZW50cnlQb2ludC5zY2hlbWU9aHR0cHMiDQogICAgICAtICItLWVudHJ5cG9pbnRzLndlYi5odHRwLnJlZGlyZWN0aW9ucy5lbnRyeVBvaW50LnBlcm1hbmVudD10cnVlIg0KICAgICAgLSAiLS1lbnRyeXBvaW50cy5vcHMuYWRkcmVzcz06JHtUUkFFRklLX09QU19QT1JUOi05MDAwfSINCiAgICAgIC0gIi0tZW50cnlwb2ludHMub3BzLmh0dHAudGxzPWxldHNlbmNyeXB0Ig0KICAgICAgLSAiLS1lbnRyeXBvaW50cy53ZWJzZWN1cmUuYWRkcmVzcz06NDQzIg0KICAgICAgLSAiLS1lbnRyeXBvaW50cy53ZWJzZWN1cmUuaHR0cC50bHM9bGV0c2VuY3J5cHQiDQogICAgICAtICItLWNlcnRpZmljYXRlc3Jlc29sdmVycy5sZXRzZW5jcnlwdC5hY21lLmVtYWlsPSR7TEVUU0VOQ1JZUFRfRU1BSUx9Ig0KICAgICAgLSAiLS1jZXJ0aWZpY2F0ZXNyZXNvbHZlcnMubGV0c2VuY3J5cHQuYWNtZS5zdG9yYWdlPS90cmFlZmlrL2FjbWUuanNvbiINCiAgICAgIC0gIi0tY2VydGlmaWNhdGVzcmVzb2x2ZXJzLmxldHNlbmNyeXB0LmFjbWUuY2FzZXJ2ZXI9JHtMRVRTRU5DUllQVF9TRVJWRVI6LWh0dHBzOi8vYWNtZS12MDIuYXBpLmxldHNlbmNyeXB0Lm9yZy9kaXJlY3Rvcnl9Ig0KICAgICAgLSAiLS1jZXJ0aWZpY2F0ZXNyZXNvbHZlcnMubGV0c2VuY3J5cHQuYWNtZS5odHRwY2hhbGxlbmdlPXRydWUiDQogICAgICAtICItLWNlcnRpZmljYXRlc3Jlc29sdmVycy5sZXRzZW5jcnlwdC5hY21lLmh0dHBjaGFsbGVuZ2UuZW50cnlwb2ludD13ZWIiDQogICAgcG9ydHM6DQogICAgICAtICI4MDo4MCINCiAgICAgIC0gIjQ0Mzo0NDMiDQogICAgICAtICIke1RSQUVGSUtfT1BTX1BPUlQtOTAwMH06JHtUUkFFRklLX09QU19QT1JULTkwMDB9Ig0KICAgIHZvbHVtZXM6DQogICAgICAtICIuLy50cmFlZmlrOi90cmFlZmlrIg0KICAgICAgLSAiLi86L2FwcCINCiAgICAgIC0gIi92YXIvcnVuL2RvY2tlci5zb2NrOi92YXIvcnVuL2RvY2tlci5zb2NrOnJvIg0KICAgIGxhYmVsczoNCiAgICAgIC0gInRyYWVmaWsuaHR0cC5yb3V0ZXJzLnRyYWVmaWstYXBpLnNlcnZpY2U9YXBpQGludGVybmFsIg0KICAgICAgLSAidHJhZWZpay5odHRwLnJvdXRlcnMudHJhZWZpay1hcGkucnVsZT1Ib3N0KGAke0RPTUFJTn1gKSAmJiAoUGF0aFByZWZpeChgL2Rhc2hib2FyZGApIHx8IFBhdGhQcmVmaXgoYC9hcGlgKSkiDQogICAgICAtICJ0cmFlZmlrLmh0dHAucm91dGVycy50cmFlZmlrLWFwaS5lbnRyeXBvaW50cz1vcHMiDQogICAgICAtICJ0cmFlZmlrLmh0dHAucm91dGVycy50cmFlZmlrLWFwaS50bHMuY2VydHJlc29sdmVyPWxldHNlbmNyeXB0Ig0KICAgIGxvZ2dpbmc6DQogICAgICBkcml2ZXI6ICR7RE9DS0VSX0xPR19EUklWRVI6LWpvdXJuYWxkfQ0KbmV0d29ya3M6DQogIGRlZmF1bHQ6DQogICAgZXh0ZXJuYWw6DQogICAgICBuYW1lOiAiJHtET0NLRVJfTkVUV09SSzotd2VifSINCg==\r\n    encoding: b64\r\n  - path: /var/app/docker-compose.yaml\r\n    permissions: 0644\r\n    content: Im5ldHdvcmtzIjoKICAiZGVmYXVsdCI6CiAgICAiZXh0ZXJuYWwiOgogICAgICAibmFtZSI6ICIke0RPQ0tFUl9ORVRXT1JLfSIKInNlcnZpY2VzIjoKICAiYXBwIjoKICAgICJjb21tYW5kIjogIiR7Q09OVEFJTkVSX0NPTU1BTkR9IgogICAgImNvbnRhaW5lcl9uYW1lIjogIiR7Q09OVEFJTkVSX05BTUV9IgogICAgImVudl9maWxlIjoKICAgIC0gIi5lbnYiCiAgICAiaW1hZ2UiOiAiJHtJTUFHRV9OQU1FfToke0lNQUdFX1RBRzotbGF0ZXN0fSIKICAgICJsYWJlbHMiOgogICAgLSAidHJhZWZpay5lbmFibGU9JHtUUkFFRklLX0VOQUJMRTotdHJ1ZX0iCiAgICAtICJ0cmFlZmlrLmh0dHAucm91dGVycy5hcHAuZW50cnlwb2ludHM9d2Vic2VjdXJlIgogICAgLSAidHJhZWZpay5odHRwLnJvdXRlcnMuYXBwLnJ1bGU9SG9zdChgJHtET01BSU59YCkiCiAgICAtICJ0cmFlZmlrLmh0dHAucm91dGVycy5hcHAudGxzLmNlcnRyZXNvbHZlcj1sZXRzZW5jcnlwdCIKICAgIC0gInRyYWVmaWsuaHR0cC5yb3V0ZXJzLmFwcC50bHM9dHJ1ZSIKICAgICJsb2dnaW5nIjoKICAgICAgImRyaXZlciI6ICIke0RPQ0tFUl9MT0dfRFJJVkVSOi1qc29uLWZpbGV9IgogICAgInJlc3RhcnQiOiAidW5sZXNzLXN0b3BwZWQiCiJ2ZXJzaW9uIjogIjMuMyIK\r\n    encoding: b64\r\n  - path: /etc/systemd/system/traefik.service\r\n    permissions: 0644\r\n    content: |\r\n      [Unit]\r\n      Description=Docker Compose Service (traefik)\r\n      Requires=docker.service \r\n      After=docker.service\r\n\r\n      [Service]\r\n      Type=oneshot\r\n      RemainAfterExit=yes\r\n      WorkingDirectory=/var/app\r\n      EnvironmentFile=/var/app/.env\r\n      ExecStartPre=-/usr/bin/docker run --rm \\\r\n        -v /var/run/docker.sock:/var/run/docker.sock \\\r\n        -v \"/var/app:/var/app\" -w=\"/var/app\" \\\r\n        \"${COMPOSE_DOCKER_IMAGE}:${COMPOSE_DOCKER_TAG}\" -f docker-compose.traefik.yaml rm\r\n      ExecStart=/usr/bin/docker run --rm \\\r\n        -v /var/run/docker.sock:/var/run/docker.sock \\\r\n        -v \"/var/app:/var/app\" -w=\"/var/app\" \\\r\n        \"${COMPOSE_DOCKER_IMAGE}:${COMPOSE_DOCKER_TAG}\" -f docker-compose.traefik.yaml up -d\r\n      ExecStop=/usr/bin/docker run --rm \\\r\n        -v /var/run/docker.sock:/var/run/docker.sock \\\r\n        -v \"/var/app:/var/app\" -w=\"/var/app\" \\\r\n        \"${COMPOSE_DOCKER_IMAGE}:${COMPOSE_DOCKER_TAG}\" -f docker-compose.traefik.yaml stop -t 15\r\n\r\n      [Install]\r\n      WantedBy=multi-user.target\r\n\r\n  - path: /etc/systemd/system/app.service\r\n    permissions: 0644\r\n    content: |\r\n      [Unit]\r\n      Description=Docker Compose Service (app)\r\n      Requires=docker.service traefik.service\r\n      After=docker.service\r\n\r\n      [Service]\r\n      Type=oneshot\r\n      RemainAfterExit=yes\r\n      WorkingDirectory=/var/app\r\n      EnvironmentFile=/var/app/.env\r\n      ExecStartPre=-/usr/bin/docker run --rm \\\r\n        -v /var/run/docker.sock:/var/run/docker.sock \\\r\n        -v \"/var/app:/var/app\" -w=\"/var/app\" \\\r\n        \"${COMPOSE_DOCKER_IMAGE}:${COMPOSE_DOCKER_TAG}\" -f docker-compose.yaml rm\r\n      ExecStart=/usr/bin/docker run --rm \\\r\n        -v /var/run/docker.sock:/var/run/docker.sock \\\r\n        -v \"/var/app:/var/app\" -w=\"/var/app\" \\\r\n        \"${COMPOSE_DOCKER_IMAGE}:${COMPOSE_DOCKER_TAG}\" -f docker-compose.yaml up -d\r\n      ExecStop=/usr/bin/docker run --rm \\\r\n        -v /var/run/docker.sock:/var/run/docker.sock \\\r\n        -v \"/var/app:/var/app\" -w=\"/var/app\" \\\r\n        \"${COMPOSE_DOCKER_IMAGE}:${COMPOSE_DOCKER_TAG}\" -f docker-compose.yaml stop -t 15\r\n\r\n      [Install]\r\n      WantedBy=multi-user.target\r\n\r\n  - path: /etc/systemd/system/app-monitor.service\r\n    permissions: 0644\r\n    content: |\r\n      [Unit]\r\n      Description=Restart application\r\n\r\n      [Service]\r\n      Type=oneshot\r\n      WorkingDirectory=/var/app\r\n      EnvironmentFile=/var/app/.env\r\n      ExecStartPre=-/usr/bin/docker run --rm \\\r\n        -v /var/run/docker.sock:/var/run/docker.sock \\\r\n        -v \"/var/app:/var/app\" -w=\"/var/app\" \\\r\n        \"${COMPOSE_DOCKER_IMAGE}:${COMPOSE_DOCKER_TAG}\" pull --ignore-pull-failures\r\n      ExecStart=/usr/bin/systemctl restart app.service\r\n\r\n      [Install]\r\n      WantedBy=multi-user.target\r\n\r\n  - path: /etc/systemd/system/app-monitor.path\r\n    permissions: 0644\r\n    content: |\r\n      [Unit]\r\n      Description=Watch for updates to .env\r\n      After=app.service\r\n\r\n      [Path]\r\n      PathChanged=/var/app/.env\r\n\r\n      [Install]\r\n      WantedBy=multi-user.target\r\n\r\nruncmd:\r\n  # Install Docker if required. Note: This installation method is not\r\n  # recommended for production deployments\r\n  # https://github.com/docker/docker-install\r\n  - which docker \u003e /dev/null 2\u003e\u00261 || curl -fsSL https://get.docker.com | sh\r\n  # Create network used by Traefik to identify running containers\r\n  - \"[ $(docker network list -q --filter=name=web) ] || docker network create web\"\r\n  # Enable systemd services responsible for managing Docker Compose services\r\n  - systemctl daemon-reload \u0026\u0026 systemctl enable --now app app-monitor.path\r\n",
                "content_type": "text/cloud-config",
                "filename": "cloud-init.yaml",
                "merge_type": "list(append)+dict(no_replace,recurse_list)+str()"
              }
            ],
            "rendered": "Content-Type: multipart/mixed; boundary=\"MIMEBOUNDARY\"\nMIME-Version: 1.0\r\n\r\n--MIMEBOUNDARY\r\nContent-Disposition: attachment; filename=\"cloud-init.yaml\"\r\nContent-Transfer-Encoding: 7bit\r\nContent-Type: text/cloud-config\r\nMime-Version: 1.0\r\nX-Merge-Type: list(append)+dict(no_replace,recurse_list)+str()\r\n\r\n#cloud-config\r\n\r\nwrite_files:\r\n  - path: /var/app/.env\r\n    permissions: 0644\r\n    content: Q09NUE9TRV9ET0NLRVJfSU1BR0U9ZG9ja2VyL2NvbXBvc2UKQ09NUE9TRV9ET0NLRVJfVEFHPWxhdGVzdApET0NLRVJfTkVUV09SSz13ZWIKRE9NQUlOPXJhbW11cy50ZWNoCklNQUdFX05BTUU9am9zaHVheG9uZy9yYWNpbmctb2Rkcy1zY3JhcGVyCklNQUdFX1RBRz1sYXRlc3QKTEVUU0VOQ1JZUFRfRU1BSUw9am9zaHVhb25nMjAwMEBnbWFpbC5jb20=\r\n    encoding: b64\r\n  - path: /var/app/docker-compose.traefik.yaml\r\n    permissions: 0644\r\n    content: dmVyc2lvbjogIjMuMyINCg0Kc2VydmljZXM6DQogIHRyYWVmaWs6DQogICAgcmVzdGFydDogdW5sZXNzLXN0b3BwZWQNCiAgICBpbWFnZTogInRyYWVmaWs6JHtUUkFFRklLX0lNQUdFX1RBRzotdjIuMn0iDQogICAgY29udGFpbmVyX25hbWU6ICJ0cmFlZmlrIg0KICAgIGNvbW1hbmQ6DQogICAgICAtICItLWxvZy5sZXZlbD0ke1RSQUVGSUtfTE9HX0xFVkVMOi1pbmZvfSINCiAgICAgIC0gIi0tYXBpLmRhc2hib2FyZD0ke1RSQUVGSUtfQVBJX0RBU0hCT0FSRDotZmFsc2V9Ig0KICAgICAgLSAiLS1hY2Nlc3Nsb2cuZmlsdGVycy5zdGF0dXNjb2Rlcz00MDAtNTk5Ig0KICAgICAgLSAiLS1hY2Nlc3Nsb2cuZmlsdGVycy5yZXRyeWF0dGVtcHRzPXRydWUiDQogICAgICAtICItLWFjY2Vzc2xvZy5maWx0ZXJzLm1pbmR1cmF0aW9uPTEwMG1zIg0KICAgICAgLSAiLS1wcm92aWRlcnMuZG9ja2VyPXRydWUiDQogICAgICAtICItLXByb3ZpZGVycy5kb2NrZXIuZXhwb3NlZGJ5ZGVmYXVsdD0ke1RSQUVGSUtfRVhQT1NFRF9CWV9ERUZBVUxUOi10cnVlfSINCiAgICAgIC0gIi0tcHJvdmlkZXJzLmRvY2tlci5uZXR3b3JrPSR7RE9DS0VSX05FVFdPUks6LXdlYn0iDQogICAgICAtICItLWVudHJ5cG9pbnRzLndlYi5hZGRyZXNzPTo4MCINCiAgICAgIC0gIi0tZW50cnlwb2ludHMud2ViLmh0dHAucmVkaXJlY3Rpb25zLmVudHJ5UG9pbnQudG89d2Vic2VjdXJlIg0KICAgICAgLSAiLS1lbnRyeXBvaW50cy53ZWIuaHR0cC5yZWRpcmVjdGlvbnMuZW50cnlQb2ludC5zY2hlbWU9aHR0cHMiDQogICAgICAtICItLWVudHJ5cG9pbnRzLndlYi5odHRwLnJlZGlyZWN0aW9ucy5lbnRyeVBvaW50LnBlcm1hbmVudD10cnVlIg0KICAgICAgLSAiLS1lbnRyeXBvaW50cy5vcHMuYWRkcmVzcz06JHtUUkFFRklLX09QU19QT1JUOi05MDAwfSINCiAgICAgIC0gIi0tZW50cnlwb2ludHMub3BzLmh0dHAudGxzPWxldHNlbmNyeXB0Ig0KICAgICAgLSAiLS1lbnRyeXBvaW50cy53ZWJzZWN1cmUuYWRkcmVzcz06NDQzIg0KICAgICAgLSAiLS1lbnRyeXBvaW50cy53ZWJzZWN1cmUuaHR0cC50bHM9bGV0c2VuY3J5cHQiDQogICAgICAtICItLWNlcnRpZmljYXRlc3Jlc29sdmVycy5sZXRzZW5jcnlwdC5hY21lLmVtYWlsPSR7TEVUU0VOQ1JZUFRfRU1BSUx9Ig0KICAgICAgLSAiLS1jZXJ0aWZpY2F0ZXNyZXNvbHZlcnMubGV0c2VuY3J5cHQuYWNtZS5zdG9yYWdlPS90cmFlZmlrL2FjbWUuanNvbiINCiAgICAgIC0gIi0tY2VydGlmaWNhdGVzcmVzb2x2ZXJzLmxldHNlbmNyeXB0LmFjbWUuY2FzZXJ2ZXI9JHtMRVRTRU5DUllQVF9TRVJWRVI6LWh0dHBzOi8vYWNtZS12MDIuYXBpLmxldHNlbmNyeXB0Lm9yZy9kaXJlY3Rvcnl9Ig0KICAgICAgLSAiLS1jZXJ0aWZpY2F0ZXNyZXNvbHZlcnMubGV0c2VuY3J5cHQuYWNtZS5odHRwY2hhbGxlbmdlPXRydWUiDQogICAgICAtICItLWNlcnRpZmljYXRlc3Jlc29sdmVycy5sZXRzZW5jcnlwdC5hY21lLmh0dHBjaGFsbGVuZ2UuZW50cnlwb2ludD13ZWIiDQogICAgcG9ydHM6DQogICAgICAtICI4MDo4MCINCiAgICAgIC0gIjQ0Mzo0NDMiDQogICAgICAtICIke1RSQUVGSUtfT1BTX1BPUlQtOTAwMH06JHtUUkFFRklLX09QU19QT1JULTkwMDB9Ig0KICAgIHZvbHVtZXM6DQogICAgICAtICIuLy50cmFlZmlrOi90cmFlZmlrIg0KICAgICAgLSAiLi86L2FwcCINCiAgICAgIC0gIi92YXIvcnVuL2RvY2tlci5zb2NrOi92YXIvcnVuL2RvY2tlci5zb2NrOnJvIg0KICAgIGxhYmVsczoNCiAgICAgIC0gInRyYWVmaWsuaHR0cC5yb3V0ZXJzLnRyYWVmaWstYXBpLnNlcnZpY2U9YXBpQGludGVybmFsIg0KICAgICAgLSAidHJhZWZpay5odHRwLnJvdXRlcnMudHJhZWZpay1hcGkucnVsZT1Ib3N0KGAke0RPTUFJTn1gKSAmJiAoUGF0aFByZWZpeChgL2Rhc2hib2FyZGApIHx8IFBhdGhQcmVmaXgoYC9hcGlgKSkiDQogICAgICAtICJ0cmFlZmlrLmh0dHAucm91dGVycy50cmFlZmlrLWFwaS5lbnRyeXBvaW50cz1vcHMiDQogICAgICAtICJ0cmFlZmlrLmh0dHAucm91dGVycy50cmFlZmlrLWFwaS50bHMuY2VydHJlc29sdmVyPWxldHNlbmNyeXB0Ig0KICAgIGxvZ2dpbmc6DQogICAgICBkcml2ZXI6ICR7RE9DS0VSX0xPR19EUklWRVI6LWpvdXJuYWxkfQ0KbmV0d29ya3M6DQogIGRlZmF1bHQ6DQogICAgZXh0ZXJuYWw6DQogICAgICBuYW1lOiAiJHtET0NLRVJfTkVUV09SSzotd2VifSINCg==\r\n    encoding: b64\r\n  - path: /var/app/docker-compose.yaml\r\n    permissions: 0644\r\n    content: Im5ldHdvcmtzIjoKICAiZGVmYXVsdCI6CiAgICAiZXh0ZXJuYWwiOgogICAgICAibmFtZSI6ICIke0RPQ0tFUl9ORVRXT1JLfSIKInNlcnZpY2VzIjoKICAiYXBwIjoKICAgICJjb21tYW5kIjogIiR7Q09OVEFJTkVSX0NPTU1BTkR9IgogICAgImNvbnRhaW5lcl9uYW1lIjogIiR7Q09OVEFJTkVSX05BTUV9IgogICAgImVudl9maWxlIjoKICAgIC0gIi5lbnYiCiAgICAiaW1hZ2UiOiAiJHtJTUFHRV9OQU1FfToke0lNQUdFX1RBRzotbGF0ZXN0fSIKICAgICJsYWJlbHMiOgogICAgLSAidHJhZWZpay5lbmFibGU9JHtUUkFFRklLX0VOQUJMRTotdHJ1ZX0iCiAgICAtICJ0cmFlZmlrLmh0dHAucm91dGVycy5hcHAuZW50cnlwb2ludHM9d2Vic2VjdXJlIgogICAgLSAidHJhZWZpay5odHRwLnJvdXRlcnMuYXBwLnJ1bGU9SG9zdChgJHtET01BSU59YCkiCiAgICAtICJ0cmFlZmlrLmh0dHAucm91dGVycy5hcHAudGxzLmNlcnRyZXNvbHZlcj1sZXRzZW5jcnlwdCIKICAgIC0gInRyYWVmaWsuaHR0cC5yb3V0ZXJzLmFwcC50bHM9dHJ1ZSIKICAgICJsb2dnaW5nIjoKICAgICAgImRyaXZlciI6ICIke0RPQ0tFUl9MT0dfRFJJVkVSOi1qc29uLWZpbGV9IgogICAgInJlc3RhcnQiOiAidW5sZXNzLXN0b3BwZWQiCiJ2ZXJzaW9uIjogIjMuMyIK\r\n    encoding: b64\r\n  - path: /etc/systemd/system/traefik.service\r\n    permissions: 0644\r\n    content: |\r\n      [Unit]\r\n      Description=Docker Compose Service (traefik)\r\n      Requires=docker.service \r\n      After=docker.service\r\n\r\n      [Service]\r\n      Type=oneshot\r\n      RemainAfterExit=yes\r\n      WorkingDirectory=/var/app\r\n      EnvironmentFile=/var/app/.env\r\n      ExecStartPre=-/usr/bin/docker run --rm \\\r\n        -v /var/run/docker.sock:/var/run/docker.sock \\\r\n        -v \"/var/app:/var/app\" -w=\"/var/app\" \\\r\n        \"${COMPOSE_DOCKER_IMAGE}:${COMPOSE_DOCKER_TAG}\" -f docker-compose.traefik.yaml rm\r\n      ExecStart=/usr/bin/docker run --rm \\\r\n        -v /var/run/docker.sock:/var/run/docker.sock \\\r\n        -v \"/var/app:/var/app\" -w=\"/var/app\" \\\r\n        \"${COMPOSE_DOCKER_IMAGE}:${COMPOSE_DOCKER_TAG}\" -f docker-compose.traefik.yaml up -d\r\n      ExecStop=/usr/bin/docker run --rm \\\r\n        -v /var/run/docker.sock:/var/run/docker.sock \\\r\n        -v \"/var/app:/var/app\" -w=\"/var/app\" \\\r\n        \"${COMPOSE_DOCKER_IMAGE}:${COMPOSE_DOCKER_TAG}\" -f docker-compose.traefik.yaml stop -t 15\r\n\r\n      [Install]\r\n      WantedBy=multi-user.target\r\n\r\n  - path: /etc/systemd/system/app.service\r\n    permissions: 0644\r\n    content: |\r\n      [Unit]\r\n      Description=Docker Compose Service (app)\r\n      Requires=docker.service traefik.service\r\n      After=docker.service\r\n\r\n      [Service]\r\n      Type=oneshot\r\n      RemainAfterExit=yes\r\n      WorkingDirectory=/var/app\r\n      EnvironmentFile=/var/app/.env\r\n      ExecStartPre=-/usr/bin/docker run --rm \\\r\n        -v /var/run/docker.sock:/var/run/docker.sock \\\r\n        -v \"/var/app:/var/app\" -w=\"/var/app\" \\\r\n        \"${COMPOSE_DOCKER_IMAGE}:${COMPOSE_DOCKER_TAG}\" -f docker-compose.yaml rm\r\n      ExecStart=/usr/bin/docker run --rm \\\r\n        -v /var/run/docker.sock:/var/run/docker.sock \\\r\n        -v \"/var/app:/var/app\" -w=\"/var/app\" \\\r\n        \"${COMPOSE_DOCKER_IMAGE}:${COMPOSE_DOCKER_TAG}\" -f docker-compose.yaml up -d\r\n      ExecStop=/usr/bin/docker run --rm \\\r\n        -v /var/run/docker.sock:/var/run/docker.sock \\\r\n        -v \"/var/app:/var/app\" -w=\"/var/app\" \\\r\n        \"${COMPOSE_DOCKER_IMAGE}:${COMPOSE_DOCKER_TAG}\" -f docker-compose.yaml stop -t 15\r\n\r\n      [Install]\r\n      WantedBy=multi-user.target\r\n\r\n  - path: /etc/systemd/system/app-monitor.service\r\n    permissions: 0644\r\n    content: |\r\n      [Unit]\r\n      Description=Restart application\r\n\r\n      [Service]\r\n      Type=oneshot\r\n      WorkingDirectory=/var/app\r\n      EnvironmentFile=/var/app/.env\r\n      ExecStartPre=-/usr/bin/docker run --rm \\\r\n        -v /var/run/docker.sock:/var/run/docker.sock \\\r\n        -v \"/var/app:/var/app\" -w=\"/var/app\" \\\r\n        \"${COMPOSE_DOCKER_IMAGE}:${COMPOSE_DOCKER_TAG}\" pull --ignore-pull-failures\r\n      ExecStart=/usr/bin/systemctl restart app.service\r\n\r\n      [Install]\r\n      WantedBy=multi-user.target\r\n\r\n  - path: /etc/systemd/system/app-monitor.path\r\n    permissions: 0644\r\n    content: |\r\n      [Unit]\r\n      Description=Watch for updates to .env\r\n      After=app.service\r\n\r\n      [Path]\r\n      PathChanged=/var/app/.env\r\n\r\n      [Install]\r\n      WantedBy=multi-user.target\r\n\r\nruncmd:\r\n  # Install Docker if required. Note: This installation method is not\r\n  # recommended for production deployments\r\n  # https://github.com/docker/docker-install\r\n  - which docker \u003e /dev/null 2\u003e\u00261 || curl -fsSL https://get.docker.com | sh\r\n  # Create network used by Traefik to identify running containers\r\n  - \"[ $(docker network list -q --filter=name=web) ] || docker network create web\"\r\n  # Enable systemd services responsible for managing Docker Compose services\r\n  - systemctl daemon-reload \u0026\u0026 systemctl enable --now app app-monitor.path\r\n\r\n--MIMEBOUNDARY--\r\n"
          },
          "sensitive_attributes": []
        }
      ]
    }
  ]
}
